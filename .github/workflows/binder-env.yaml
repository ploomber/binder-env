name: binder-env

on:
  push:
    branches: [main]
  schedule:
     - cron: '0 0 * * *' # run every day at midnight

jobs:
  binder-env:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: [3.11]

    steps:
      - uses: actions/checkout@v3
      - name: Set up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v3
        with:
          python-version: ${{ matrix.python-version }}

      - name: Install dependencies
        run: |
          sudo apt-get install -y chromium-browser
          pip install selenium==4.11.2 webdriver-manager==4.0.0 packaging==23.1

      - name: Update environment.yml
        run:
          python update-environment-yml.py

      - name: Push updated environment.yml
        run: |
          git config --global user.name 'GitHub Actions'
          git config --global user.email 'bot@ploomber.io'
          git commit -am "Edits environment.yml [BOT]"
          git push

      - name: Docker build
        run: |
          python docker-build.py https://binder.ploomber.io/v2/gh/ploomber/binder-env/main?urlpath=git-pull%3Frepo%3Dhttps%253A%252F%252Fgithub.com%252Fploomber%252Fprojects%26urlpath%3Dlab%252Ftree%252Fprojects%252FREADME.ipynb%26branch%3Dmaster
